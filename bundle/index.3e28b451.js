const m=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}};m();const i={tap:new Audio("sounds/tap1.wav"),navForward:new Audio("sounds/nav1.flac"),navBackward:new Audio("sounds/nav2.flac"),refresh:new Audio("sounds/refresh.flac"),shutter:new Audio("sounds/shutter.flac")};i.tap.volume=.5;i.navForward.volume=.1;i.navBackward.volume=.2;i.shutter.volume=.05;function h(){i.tap.play()}function y(){i.refresh.play()}function b(){i.shutter.play()}function d(t=!0,e=!1){navigator.vibrate(e?20:15),t?i.navForward.play():i.navBackward.play()}var w=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",sounds:i,tap:h,refresh:y,shutter:b,navigate:d});const p=location.origin+(document.querySelector('head > link[rel="root"]')?.getAttribute("href")??"/");L();const a={get mains(){return document.querySelectorAll("body > main")},get main(){return this.mains[this.mains.length-1]},nav:document.querySelector("body > nav"),links:document.querySelectorAll("body > nav > [page]"),header:document.querySelector("body > header")},v={async afterload(){a.main.removeAttribute("afterload"),setTimeout(()=>a.main.setAttribute("afterload",""),0)},async fullview(t=!1){t?document.body.removeAttribute("fullview"):document.body.setAttribute("fullview","")}},c={_bottom:"home",get values(){return[this._bottom,...location.href.replace(p,"").split("/").filter(t=>t!="")]},push(t){history.pushState(null,"",`${location.pathname.slice(1)}/${t}`),d(!0,!0),this.apply()},get bottom(){return this.values.length==1?this._bottom:null},set bottom(t){t&&this.values.length==1&&(this._bottom=t),d(!0),this.apply()},get top(){return this.values[this.values.length-1]},get path(){return this.values.join("/")},async apply(){console.time("applystack"),console.log(`%c${this.path}`,"color: gold"),this.values.forEach(async(t,e)=>{a.mains[e]||a.main.insertAdjacentHTML("afterend","<main/>")}),a.mains.length>this.values.length?a.main.remove():v.afterload(),v.fullview(!!this.bottom),A(this.top),k(this.top,!!this.bottom).then(()=>console.timeEnd("applystack"))}};window.stack=c;c.apply();window.onpopstate=()=>c.apply();async function A(t){document.querySelectorAll("[page]").forEach(e=>e.getAttribute("page")==t?e.setAttribute("active",""):e.removeAttribute("active"))}async function k(t,e=!0){if(a.main.innerHTML=await _(`/views/${t}.html`),!e){const o=a.main.querySelector("header");if(!o)return;o.prepend(document.createElement("button")),o.children[0].outerHTML="<button icon navback>arrow_back</button>",o.children[0].addEventListener("click",()=>history.back())}}async function _(t){let o=await(await self.caches?.open("views"))?.match(t);return o||(a.nav.setAttribute("loading",""),o=await fetch(t),a.nav.removeAttribute("loading")),await o.text()}function L(){const t=window.fetch;window.fetch=(e,o)=>{if(e instanceof Request||!e.startsWith("/"))return t(e,o);const s=new URL(e.slice(1),p).href;return t(s,o)}}const l={ripple(t){return t.getAttribute("ripple")!=null||t.getAttribute("page")!=null||t.nodeName=="BUTTON"||t.nodeName=="HEADER"||!1},dialog(t){return t.nodeName=="DIALOG"},view(t){return!!t.getAttribute("view")},page(t){return!!t.getAttribute("page")},textfield(t){return t.nodeName=="TEXTFIELD"}},S=[{if:l.ripple,then(t){t.addEventListener("pointerdown",()=>g(t)),t.addEventListener("keydown",e=>{e.key=="Enter"&&g(t,10)})}},{if:l.dialog,then(t){t.setAttribute("open","")}},{if:l.view,then(t){t.onclick=()=>{const e=t.getAttribute("view");!e||c.push(e)}}},{if:l.page,then(t){t.onclick=()=>{const e=t.getAttribute("page");!e||(c.bottom=e)}}},{if:l.textfield,then(t){t.setAttribute("contenteditable","");const e=async()=>t.innerText==""?t.setAttribute("empty",""):t.removeAttribute("empty");e(),t.oninput=e}}];function g(t,e=0){t.getAttribute("disabled")==null&&(t.removeAttribute("afterclick"),setTimeout(()=>t.setAttribute("afterclick",""),e),h())}const E=new MutationObserver(t=>{t.forEach(e=>{e.addedNodes.forEach(o=>o.nodeName!="#text"?f(o):0)})});E.observe(document.body,{childList:!0,subtree:!0});document.querySelectorAll("body *").forEach(t=>f(t));function f(t){S.forEach(e=>{t.nodeName!="#comment"&&e.if(t)&&e.then(t)});for(const e in t.children){const o=t.children[e];o.getAttribute&&f(o)}}if(navigator.serviceWorker){location.host!="localhost:3500"&&navigator.serviceWorker?.register(new URL("/lifectl/sw.js",self.location).href),navigator.serviceWorker.onmessage=e=>{e.data=="update"&&location.reload()};const t=async()=>{if(!navigator.onLine){console.warn("%cCannot update caches while offline!","color: orange");return}navigator.serviceWorker.controller?.postMessage("update")};window.updateCaches=t}Object.defineProperty(window,"routines",{get:()=>JSON.parse(localStorage.getItem("routines")??"[]")});const O={get all(){return JSON.parse(localStorage.getItem("activities")??"{}")},get(t){return this.all[t]},_set(t,e){localStorage.setItem("activities",JSON.stringify({...this.all,[t]:{...this.get(t),...e}}))},create(t,e=""){this._set(t,{description:e,created:new Date().valueOf(),records:[]})},start(t){const e=this.get(t).records;e[this._today(t)]=[...e[this._today(t)]??[],{start:new Date().getTime()}],this._set(t,{records:e})},finish(t){const e=this.get(t)?.records;if(!e)return;const o=e[this._today(t)],s=o[o.length-1];s.finish=new Date().valueOf(),this._set(t,{records:e})},lastAbsence(t){const e=this.get(t).records.length-1;return this._today(t)-e>0?this._today(t)-e:0},_today(t){return Math.floor((new Date().valueOf()-this.get(t).created)/864e5)}};window.activities=O;window.sounds=w;
